// query-geoip-lookup.kql
// Enrich failed login events with the geoip watchlist named "geoip".
// Replace <ATTACKER_IP> with the observed attacker IP, or remove the where clause to see all entries.

let GeoIPDB_FULL = _GetWatchlist("geoip");
let WindowsEvents = SecurityEvent
    | where IpAddress == "<Attacker_ip>"
    | where EventID == 4625
    | order by TimeGenerated desc
    | evaluate ipv4_lookup(GeoIPDB_FULL, IpAddress, network);
WindowsEvents
